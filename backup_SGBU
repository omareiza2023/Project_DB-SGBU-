--
-- PostgreSQL database dump
--

-- Dumped from database version 17.2 (Debian 17.2-1.pgdg120+1)
-- Dumped by pg_dump version 17.2

-- Started on 2025-05-01 17:23:09 UTC

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 310 (class 1255 OID 58504)
-- Name: calcular_dias_retraso(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.calcular_dias_retraso(id_prestamo integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    dias_retraso INTEGER;
BEGIN
    SELECT EXTRACT(DAY FROM CURRENT_DATE - p.fecha_devolucion_esperada)
    INTO dias_retraso
    FROM prestamo p
    WHERE p.id_prestamo = id_prestamo;
    
    IF dias_retraso < 0 THEN
        RETURN 0;  -- Si no está retrasado, se devuelve 0
    ELSE
        RETURN dias_retraso;
    END IF;
END;
$$;


ALTER FUNCTION public.calcular_dias_retraso(id_prestamo integer) OWNER TO grupo2;

--
-- TOC entry 314 (class 1255 OID 58508)
-- Name: calcular_multa_por_retraso(integer, numeric); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.calcular_multa_por_retraso(id_prestamo integer, tarifa_diaria numeric) RETURNS numeric
    LANGUAGE plpgsql
    AS $$
DECLARE
    dias_retraso INTEGER;
    monto DECIMAL;
BEGIN
    -- Calcular el retraso en días
    SELECT EXTRACT(DAY FROM CURRENT_DATE - p.fecha_devolucion_esperada)
    INTO dias_retraso
    FROM prestamo p
    WHERE p.id_prestamo = id_prestamo;

    -- Si el retraso es mayor a 0, calcular la multa
    IF dias_retraso > 0 THEN
        monto := dias_retraso * tarifa_diaria;
        RETURN monto;
    ELSE
        RETURN 0;  -- Si no hay retraso, no hay multa
    END IF;
END;
$$;


ALTER FUNCTION public.calcular_multa_por_retraso(id_prestamo integer, tarifa_diaria numeric) OWNER TO grupo2;

--
-- TOC entry 308 (class 1255 OID 58502)
-- Name: calcular_prestamos_activos(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.calcular_prestamos_activos(id_socio integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT COUNT(*) 
            FROM prestamo 
            WHERE id_socio = id_socio AND fecha_devolucion_esperada >= CURRENT_DATE);
END;
$$;


ALTER FUNCTION public.calcular_prestamos_activos(id_socio integer) OWNER TO grupo2;

--
-- TOC entry 312 (class 1255 OID 58506)
-- Name: calcular_tiempo_restante_reserva(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.calcular_tiempo_restante_reserva(id_reserva integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
DECLARE
    tiempo_restante INTEGER;
BEGIN
    SELECT EXTRACT(DAY FROM r.fecha_reserva - CURRENT_DATE)
    INTO tiempo_restante
    FROM reserva r
    WHERE r.id_reserva = id_reserva;

    IF tiempo_restante < 0 THEN
        RETURN 0; -- Si la reserva ya expiró, retornamos 0
    ELSE
        RETURN tiempo_restante;
    END IF;
END;
$$;


ALTER FUNCTION public.calcular_tiempo_restante_reserva(id_reserva integer) OWNER TO grupo2;

--
-- TOC entry 317 (class 1255 OID 58513)
-- Name: contar_prestamos_libro(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.contar_prestamos_libro(id_libro integer) RETURNS integer
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT COUNT(*) FROM historial_prestamo WHERE id_copia IN (SELECT id_copia FROM copia WHERE id_libro = id_libro));
END;
$$;


ALTER FUNCTION public.contar_prestamos_libro(id_libro integer) OWNER TO grupo2;

--
-- TOC entry 319 (class 1255 OID 58522)
-- Name: eliminar_multa_y_prestamo(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.eliminar_multa_y_prestamo(prestamo_id integer) RETURNS void
    LANGUAGE plpgsql
    AS $$
DECLARE
    multa_rec RECORD;
BEGIN
    -- Eliminar la multa asociada al préstamo
    FOR multa_rec IN
        SELECT m.id_multa, m.id_prestamo
        FROM multa m
        WHERE m.id_prestamo = prestamo_id  -- Usamos la nueva variable prestamo_id
    LOOP
        -- Eliminar la multa
        DELETE FROM multa WHERE id_multa = multa_rec.id_multa;
    END LOOP;

    -- Eliminar el préstamo
    DELETE FROM prestamo WHERE id_prestamo = prestamo_id; -- Usamos la nueva variable prestamo_id
       
END;
$$;


ALTER FUNCTION public.eliminar_multa_y_prestamo(prestamo_id integer) OWNER TO grupo2;

--
-- TOC entry 305 (class 1255 OID 58489)
-- Name: fn_auditoria_general(); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.fn_auditoria_general() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    v_operacion TEXT;
    v_datos_anteriores JSONB;
    v_datos_nuevos JSONB;
BEGIN
    -- Determinar la operación realizada
    IF TG_OP = 'INSERT' THEN
        v_operacion := 'INSERT';
        v_datos_anteriores := NULL;
        v_datos_nuevos := to_jsonb(NEW);
    ELSIF TG_OP = 'UPDATE' THEN
        v_operacion := 'UPDATE';
        v_datos_anteriores := to_jsonb(OLD);
        v_datos_nuevos := to_jsonb(NEW);
    ELSIF TG_OP = 'DELETE' THEN
        v_operacion := 'DELETE';
        v_datos_anteriores := to_jsonb(OLD);
        v_datos_nuevos := NULL;
    END IF;

    -- Insertar el registro de auditoría
    INSERT INTO auditoria_general(tabla_afectada, operacion, usuario, datos_anteriores, datos_nuevos)
    VALUES (TG_TABLE_NAME, v_operacion, current_user, v_datos_anteriores, v_datos_nuevos);

    -- Si la operación es una inserción en reserva, insertar en historial_prestamo
    IF TG_OP = 'INSERT' AND TG_TABLE_NAME = 'reserva' THEN
        INSERT INTO historial_prestamo(id_socio, id_copia, fecha_prestamo, fecha_devolucion, observaciones)
        VALUES (NEW.id_socio, NEW.id_copia, NEW.fecha_reserva, NULL, 'Reserva creada automáticamente');
    END IF;

    RETURN NULL;
END;
$$;


ALTER FUNCTION public.fn_auditoria_general() OWNER TO grupo2;

--
-- TOC entry 318 (class 1255 OID 58514)
-- Name: generar_multas_por_retraso(); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.generar_multas_por_retraso() RETURNS void
    LANGUAGE plpgsql
    AS $_$
DECLARE
    prestamo_rec RECORD;
    dias_retraso INT;
BEGIN
    FOR prestamo_rec IN
        SELECT p.id_prestamo, p.id_socio, p.fecha_devolucion_esperada
        FROM prestamo p
        WHERE p.fecha_devolucion_esperada < CURRENT_DATE
        AND p.id_socio NOT IN (
            SELECT m.id_socio
            FROM multa m
            WHERE m.estado = 'Pendiente'
        )
    LOOP
        -- Calcular el número de días de retraso
        dias_retraso := CURRENT_DATE - prestamo_rec.fecha_devolucion_esperada;
        
        -- Generar la multa
        INSERT INTO multa (id_socio, monto, motivo, fecha, estado)
        VALUES (
            prestamo_rec.id_socio,
            dias_retraso * 5.00,  -- Ejemplo: $5 por cada día de retraso
            'Retraso en la devolución del préstamo',
            CURRENT_DATE,
            'Pendiente'
        );
    END LOOP;
END;
$_$;


ALTER FUNCTION public.generar_multas_por_retraso() OWNER TO grupo2;

--
-- TOC entry 315 (class 1255 OID 58511)
-- Name: libro_tiene_copias_disponibles(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.libro_tiene_copias_disponibles(id_libro integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN EXISTS (SELECT 1
                   FROM copia
                   WHERE id_libro = id_libro AND estado = 'Disponible');
END;
$$;


ALTER FUNCTION public.libro_tiene_copias_disponibles(id_libro integer) OWNER TO grupo2;

--
-- TOC entry 311 (class 1255 OID 58505)
-- Name: obtener_categoria_libro(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.obtener_categoria_libro(id_libro integer) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT c.nombre 
            FROM libro l
            JOIN categoria c ON l.id_categoria = c.id_categoria
            WHERE l.id_libro = id_libro);
END;
$$;


ALTER FUNCTION public.obtener_categoria_libro(id_libro integer) OWNER TO grupo2;

--
-- TOC entry 306 (class 1255 OID 58500)
-- Name: obtener_correo_persona(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.obtener_correo_persona(id integer) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT correo FROM persona WHERE id_persona = id);
END;
$$;


ALTER FUNCTION public.obtener_correo_persona(id integer) OWNER TO grupo2;

--
-- TOC entry 313 (class 1255 OID 58507)
-- Name: obtener_estado_copia_reserva(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.obtener_estado_copia_reserva(id_reserva integer) RETURNS character varying
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT c.estado
            FROM reserva r
            JOIN copia c ON r.id_copia = c.id_copia
            WHERE r.id_reserva = id_reserva);
END;
$$;


ALTER FUNCTION public.obtener_estado_copia_reserva(id_reserva integer) OWNER TO grupo2;

--
-- TOC entry 316 (class 1255 OID 58512)
-- Name: obtener_historial_completo(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.obtener_historial_completo(id_socio integer) RETURNS TABLE(id_historial integer, id_copia integer, fecha_prestamo date, fecha_devolucion date)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
    SELECT hp.id_historial, hp.id_copia, hp.fecha_prestamo, hp.fecha_devolucion
    FROM historial_prestamo hp
    WHERE hp.id_socio = id_socio;
END;
$$;


ALTER FUNCTION public.obtener_historial_completo(id_socio integer) OWNER TO grupo2;

--
-- TOC entry 255 (class 1255 OID 58509)
-- Name: obtener_multas_acumuladas_socio(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.obtener_multas_acumuladas_socio(id_socio integer) RETURNS numeric
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT SUM(m.monto)
            FROM multa m
            WHERE m.id_socio = id_socio AND m.estado = 'Pendiente');
END;
$$;


ALTER FUNCTION public.obtener_multas_acumuladas_socio(id_socio integer) OWNER TO grupo2;

--
-- TOC entry 307 (class 1255 OID 58501)
-- Name: persona_existe_por_correo(character varying); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.persona_existe_por_correo(correo character varying) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN EXISTS (SELECT 1 FROM persona WHERE correo = correo);
END;
$$;


ALTER FUNCTION public.persona_existe_por_correo(correo character varying) OWNER TO grupo2;

--
-- TOC entry 309 (class 1255 OID 58503)
-- Name: socio_tiene_prestamos_activos_mayores_a(integer, integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.socio_tiene_prestamos_activos_mayores_a(id_socio integer, limite integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN (SELECT COUNT(*) 
            FROM prestamo 
            WHERE id_socio = id_socio AND fecha_devolucion_esperada >= CURRENT_DATE) > limite;
END;
$$;


ALTER FUNCTION public.socio_tiene_prestamos_activos_mayores_a(id_socio integer, limite integer) OWNER TO grupo2;

--
-- TOC entry 272 (class 1255 OID 58468)
-- Name: sp_delete_autor(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_autor(IN p_id_autor integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM autor WHERE id_autor = p_id_autor;
END;
$$;


ALTER PROCEDURE public.sp_delete_autor(IN p_id_autor integer) OWNER TO grupo2;

--
-- TOC entry 269 (class 1255 OID 58465)
-- Name: sp_delete_categoria(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_categoria(IN p_id_categoria integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM categoria WHERE id_categoria = p_id_categoria;
END;
$$;


ALTER PROCEDURE public.sp_delete_categoria(IN p_id_categoria integer) OWNER TO grupo2;

--
-- TOC entry 281 (class 1255 OID 58476)
-- Name: sp_delete_copia(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_copia(IN p_id_copia integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM copia WHERE id_copia = p_id_copia;
END;
$$;


ALTER PROCEDURE public.sp_delete_copia(IN p_id_copia integer) OWNER TO grupo2;

--
-- TOC entry 287 (class 1255 OID 58482)
-- Name: sp_delete_devolucion(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_devolucion(IN p_id_devolucion integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM devolucion WHERE id_devolucion = p_id_devolucion;
END;
$$;


ALTER PROCEDURE public.sp_delete_devolucion(IN p_id_devolucion integer) OWNER TO grupo2;

--
-- TOC entry 266 (class 1255 OID 58462)
-- Name: sp_delete_editorial(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_editorial(IN p_id_editorial integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM editorial WHERE id_editorial = p_id_editorial;
END;
$$;


ALTER PROCEDURE public.sp_delete_editorial(IN p_id_editorial integer) OWNER TO grupo2;

--
-- TOC entry 276 (class 1255 OID 58471)
-- Name: sp_delete_libro(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_libro(IN p_id_libro integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM libro WHERE id_libro = p_id_libro;
END;
$$;


ALTER PROCEDURE public.sp_delete_libro(IN p_id_libro integer) OWNER TO grupo2;

--
-- TOC entry 278 (class 1255 OID 58473)
-- Name: sp_delete_libro_autor(integer, integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_libro_autor(IN p_id_libro integer, IN p_id_autor integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM libro_autor
    WHERE id_libro = p_id_libro AND id_autor = p_id_autor;
END;
$$;


ALTER PROCEDURE public.sp_delete_libro_autor(IN p_id_libro integer, IN p_id_autor integer) OWNER TO grupo2;

--
-- TOC entry 304 (class 1255 OID 58488)
-- Name: sp_delete_multa(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_multa(IN p_id_multa integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM multa WHERE id_multa = p_id_multa;
END;
$$;


ALTER PROCEDURE public.sp_delete_multa(IN p_id_multa integer) OWNER TO grupo2;

--
-- TOC entry 257 (class 1255 OID 58453)
-- Name: sp_delete_persona(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_persona(IN p_id integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM persona WHERE id_persona = p_id;
END;
$$;


ALTER PROCEDURE public.sp_delete_persona(IN p_id integer) OWNER TO grupo2;

--
-- TOC entry 263 (class 1255 OID 58459)
-- Name: sp_delete_personal_biblioteca(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_personal_biblioteca(IN p_id_personal integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM personal_biblioteca WHERE id_personal = p_id_personal;
END;
$$;


ALTER PROCEDURE public.sp_delete_personal_biblioteca(IN p_id_personal integer) OWNER TO grupo2;

--
-- TOC entry 284 (class 1255 OID 58479)
-- Name: sp_delete_prestamo(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_prestamo(IN p_id_prestamo integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM prestamo WHERE id_prestamo = p_id_prestamo;
END;
$$;


ALTER PROCEDURE public.sp_delete_prestamo(IN p_id_prestamo integer) OWNER TO grupo2;

--
-- TOC entry 290 (class 1255 OID 58485)
-- Name: sp_delete_reserva(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_reserva(IN p_id_reserva integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM reserva WHERE id_reserva = p_id_reserva;
END;
$$;


ALTER PROCEDURE public.sp_delete_reserva(IN p_id_reserva integer) OWNER TO grupo2;

--
-- TOC entry 260 (class 1255 OID 58456)
-- Name: sp_delete_socio(integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_delete_socio(IN p_id_socio integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    DELETE FROM socio WHERE id_socio = p_id_socio;
END;
$$;


ALTER PROCEDURE public.sp_delete_socio(IN p_id_socio integer) OWNER TO grupo2;

--
-- TOC entry 270 (class 1255 OID 58466)
-- Name: sp_insert_autor(character varying, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_autor(IN p_nombre character varying, IN p_nacionalidad character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO autor(nombre, nacionalidad)
    VALUES (p_nombre, p_nacionalidad);
END;
$$;


ALTER PROCEDURE public.sp_insert_autor(IN p_nombre character varying, IN p_nacionalidad character varying) OWNER TO grupo2;

--
-- TOC entry 267 (class 1255 OID 58463)
-- Name: sp_insert_categoria(character varying, text); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_categoria(IN p_nombre character varying, IN p_descripcion text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO categoria(nombre, descripcion)
    VALUES (p_nombre, p_descripcion);
END;
$$;


ALTER PROCEDURE public.sp_insert_categoria(IN p_nombre character varying, IN p_descripcion text) OWNER TO grupo2;

--
-- TOC entry 279 (class 1255 OID 58474)
-- Name: sp_insert_copia(integer, character varying, character varying, text, integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_copia(IN p_id_libro integer, IN p_codigo_barra character varying, IN p_estado character varying, IN p_ubicacion text, IN p_cantidad integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO copia(id_libro, codigo_barra, estado, ubicacion, cantidad)
    VALUES (p_id_libro, p_codigo_barra, p_estado, p_ubicacion, p_cantidad);
END;
$$;


ALTER PROCEDURE public.sp_insert_copia(IN p_id_libro integer, IN p_codigo_barra character varying, IN p_estado character varying, IN p_ubicacion text, IN p_cantidad integer) OWNER TO grupo2;

--
-- TOC entry 285 (class 1255 OID 58480)
-- Name: sp_insert_devolucion(integer, date, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_devolucion(IN p_id_prestamo integer, IN p_fecha_real_devolucion date, IN p_estado character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO devolucion(id_prestamo, fecha_real_devolucion, estado)
    VALUES (p_id_prestamo, p_fecha_real_devolucion, p_estado);
END;
$$;


ALTER PROCEDURE public.sp_insert_devolucion(IN p_id_prestamo integer, IN p_fecha_real_devolucion date, IN p_estado character varying) OWNER TO grupo2;

--
-- TOC entry 264 (class 1255 OID 58460)
-- Name: sp_insert_editorial(character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_editorial(IN p_nombre character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO editorial(nombre)
    VALUES (p_nombre);
END;
$$;


ALTER PROCEDURE public.sp_insert_editorial(IN p_nombre character varying) OWNER TO grupo2;

--
-- TOC entry 273 (class 1255 OID 58469)
-- Name: sp_insert_libro(character varying, integer, integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_libro(IN p_titulo character varying, IN p_id_editorial integer, IN p_id_categoria integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO libro(titulo, id_editorial, id_categoria)
    VALUES (p_titulo, p_id_editorial, p_id_categoria);
END;
$$;


ALTER PROCEDURE public.sp_insert_libro(IN p_titulo character varying, IN p_id_editorial integer, IN p_id_categoria integer) OWNER TO grupo2;

--
-- TOC entry 277 (class 1255 OID 58472)
-- Name: sp_insert_libro_autor(integer, integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_libro_autor(IN p_id_libro integer, IN p_id_autor integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO libro_autor(id_libro, id_autor)
    VALUES (p_id_libro, p_id_autor);
END;
$$;


ALTER PROCEDURE public.sp_insert_libro_autor(IN p_id_libro integer, IN p_id_autor integer) OWNER TO grupo2;

--
-- TOC entry 301 (class 1255 OID 58486)
-- Name: sp_insert_multa(integer, numeric, text, date, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_multa(IN p_id_socio integer, IN p_monto numeric, IN p_motivo text, IN p_fecha date, IN p_estado character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO multa(id_socio, monto, motivo, fecha, estado)
    VALUES (p_id_socio, p_monto, p_motivo, p_fecha, p_estado);
END;
$$;


ALTER PROCEDURE public.sp_insert_multa(IN p_id_socio integer, IN p_monto numeric, IN p_motivo text, IN p_fecha date, IN p_estado character varying) OWNER TO grupo2;

--
-- TOC entry 254 (class 1255 OID 58451)
-- Name: sp_insert_persona(character varying, character varying, character varying, character varying, text); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_persona(IN p_nombre character varying, IN p_apellido character varying, IN p_correo character varying, IN p_telefono character varying, IN p_direccion text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO persona(nombre, apellido, correo, telefono, direccion)
    VALUES (p_nombre, p_apellido, p_correo, p_telefono, p_direccion);
END;
$$;


ALTER PROCEDURE public.sp_insert_persona(IN p_nombre character varying, IN p_apellido character varying, IN p_correo character varying, IN p_telefono character varying, IN p_direccion text) OWNER TO grupo2;

--
-- TOC entry 261 (class 1255 OID 58457)
-- Name: sp_insert_personal_biblioteca(integer, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_personal_biblioteca(IN p_id_persona integer, IN p_rol character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO personal_biblioteca(id_persona, rol)
    VALUES (p_id_persona, p_rol);
END;
$$;


ALTER PROCEDURE public.sp_insert_personal_biblioteca(IN p_id_persona integer, IN p_rol character varying) OWNER TO grupo2;

--
-- TOC entry 282 (class 1255 OID 58477)
-- Name: sp_insert_prestamo(integer, integer, date, date); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_prestamo(IN p_id_socio integer, IN p_id_copia integer, IN p_fecha_prestamo date, IN p_fecha_devolucion_esperada date)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO prestamo(id_socio, id_copia, fecha_prestamo, fecha_devolucion_esperada)
    VALUES (p_id_socio, p_id_copia, p_fecha_prestamo, p_fecha_devolucion_esperada);
END;
$$;


ALTER PROCEDURE public.sp_insert_prestamo(IN p_id_socio integer, IN p_id_copia integer, IN p_fecha_prestamo date, IN p_fecha_devolucion_esperada date) OWNER TO grupo2;

--
-- TOC entry 288 (class 1255 OID 58483)
-- Name: sp_insert_reserva(integer, integer, date, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_reserva(IN p_id_socio integer, IN p_id_copia integer, IN p_fecha_reserva date, IN p_estado character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO reserva(id_socio, id_copia, fecha_reserva, estado)
    VALUES (p_id_socio, p_id_copia, p_fecha_reserva, p_estado);
END;
$$;


ALTER PROCEDURE public.sp_insert_reserva(IN p_id_socio integer, IN p_id_copia integer, IN p_fecha_reserva date, IN p_estado character varying) OWNER TO grupo2;

--
-- TOC entry 258 (class 1255 OID 58454)
-- Name: sp_insert_socio(integer, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_insert_socio(IN p_id_persona integer, IN p_tipo_socio character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    INSERT INTO socio(id_persona, tipo_socio)
    VALUES (p_id_persona, p_tipo_socio);
END;
$$;


ALTER PROCEDURE public.sp_insert_socio(IN p_id_persona integer, IN p_tipo_socio character varying) OWNER TO grupo2;

--
-- TOC entry 271 (class 1255 OID 58467)
-- Name: sp_update_autor(integer, character varying, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_autor(IN p_id_autor integer, IN p_nombre character varying, IN p_nacionalidad character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE autor
    SET nombre = p_nombre,
        nacionalidad = p_nacionalidad
    WHERE id_autor = p_id_autor;
END;
$$;


ALTER PROCEDURE public.sp_update_autor(IN p_id_autor integer, IN p_nombre character varying, IN p_nacionalidad character varying) OWNER TO grupo2;

--
-- TOC entry 268 (class 1255 OID 58464)
-- Name: sp_update_categoria(integer, character varying, text); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_categoria(IN p_id_categoria integer, IN p_nombre character varying, IN p_descripcion text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE categoria
    SET nombre = p_nombre,
        descripcion = p_descripcion
    WHERE id_categoria = p_id_categoria;
END;
$$;


ALTER PROCEDURE public.sp_update_categoria(IN p_id_categoria integer, IN p_nombre character varying, IN p_descripcion text) OWNER TO grupo2;

--
-- TOC entry 280 (class 1255 OID 58475)
-- Name: sp_update_copia(integer, character varying, text, integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_copia(IN p_id_copia integer, IN p_estado character varying, IN p_ubicacion text, IN p_cantidad integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE copia
    SET estado = p_estado,
        ubicacion = p_ubicacion,
        cantidad = p_cantidad
    WHERE id_copia = p_id_copia;
END;
$$;


ALTER PROCEDURE public.sp_update_copia(IN p_id_copia integer, IN p_estado character varying, IN p_ubicacion text, IN p_cantidad integer) OWNER TO grupo2;

--
-- TOC entry 286 (class 1255 OID 58481)
-- Name: sp_update_devolucion(integer, date, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_devolucion(IN p_id_devolucion integer, IN p_fecha_real_devolucion date, IN p_estado character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE devolucion
    SET fecha_real_devolucion = p_fecha_real_devolucion,
        estado = p_estado
    WHERE id_devolucion = p_id_devolucion;
END;
$$;


ALTER PROCEDURE public.sp_update_devolucion(IN p_id_devolucion integer, IN p_fecha_real_devolucion date, IN p_estado character varying) OWNER TO grupo2;

--
-- TOC entry 265 (class 1255 OID 58461)
-- Name: sp_update_editorial(integer, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_editorial(IN p_id_editorial integer, IN p_nombre character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE editorial
    SET nombre = p_nombre
    WHERE id_editorial = p_id_editorial;
END;
$$;


ALTER PROCEDURE public.sp_update_editorial(IN p_id_editorial integer, IN p_nombre character varying) OWNER TO grupo2;

--
-- TOC entry 275 (class 1255 OID 58470)
-- Name: sp_update_libro(integer, character varying, integer, integer); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_libro(IN p_id_libro integer, IN p_titulo character varying, IN p_id_editorial integer, IN p_id_categoria integer)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE libro
    SET titulo = p_titulo,
        id_editorial = p_id_editorial,
        id_categoria = p_id_categoria
    WHERE id_libro = p_id_libro;
END;
$$;


ALTER PROCEDURE public.sp_update_libro(IN p_id_libro integer, IN p_titulo character varying, IN p_id_editorial integer, IN p_id_categoria integer) OWNER TO grupo2;

--
-- TOC entry 303 (class 1255 OID 58487)
-- Name: sp_update_multa(integer, numeric, text, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_multa(IN p_id_multa integer, IN p_monto numeric, IN p_motivo text, IN p_estado character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE multa
    SET monto = p_monto,
        motivo = p_motivo,
        estado = p_estado
    WHERE id_multa = p_id_multa;
END;
$$;


ALTER PROCEDURE public.sp_update_multa(IN p_id_multa integer, IN p_monto numeric, IN p_motivo text, IN p_estado character varying) OWNER TO grupo2;

--
-- TOC entry 256 (class 1255 OID 58452)
-- Name: sp_update_persona(integer, character varying, character varying, character varying, character varying, text); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_persona(IN p_id integer, IN p_nombre character varying, IN p_apellido character varying, IN p_correo character varying, IN p_telefono character varying, IN p_direccion text)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE persona
    SET nombre = p_nombre,
        apellido = p_apellido,
        correo = p_correo,
        telefono = p_telefono,
        direccion = p_direccion
    WHERE id_persona = p_id;
END;
$$;


ALTER PROCEDURE public.sp_update_persona(IN p_id integer, IN p_nombre character varying, IN p_apellido character varying, IN p_correo character varying, IN p_telefono character varying, IN p_direccion text) OWNER TO grupo2;

--
-- TOC entry 262 (class 1255 OID 58458)
-- Name: sp_update_personal_biblioteca(integer, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_personal_biblioteca(IN p_id_personal integer, IN p_rol character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE personal_biblioteca
    SET rol = p_rol
    WHERE id_personal = p_id_personal;
END;
$$;


ALTER PROCEDURE public.sp_update_personal_biblioteca(IN p_id_personal integer, IN p_rol character varying) OWNER TO grupo2;

--
-- TOC entry 283 (class 1255 OID 58478)
-- Name: sp_update_prestamo(integer, date); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_prestamo(IN p_id_prestamo integer, IN p_fecha_devolucion_esperada date)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE prestamo
    SET fecha_devolucion_esperada = p_fecha_devolucion_esperada
    WHERE id_prestamo = p_id_prestamo;
END;
$$;


ALTER PROCEDURE public.sp_update_prestamo(IN p_id_prestamo integer, IN p_fecha_devolucion_esperada date) OWNER TO grupo2;

--
-- TOC entry 289 (class 1255 OID 58484)
-- Name: sp_update_reserva(integer, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_reserva(IN p_id_reserva integer, IN p_estado character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE reserva
    SET estado = p_estado
    WHERE id_reserva = p_id_reserva;
END;
$$;


ALTER PROCEDURE public.sp_update_reserva(IN p_id_reserva integer, IN p_estado character varying) OWNER TO grupo2;

--
-- TOC entry 259 (class 1255 OID 58455)
-- Name: sp_update_socio(integer, character varying); Type: PROCEDURE; Schema: public; Owner: grupo2
--

CREATE PROCEDURE public.sp_update_socio(IN p_id_socio integer, IN p_tipo_socio character varying)
    LANGUAGE plpgsql
    AS $$
BEGIN
    UPDATE socio
    SET tipo_socio = p_tipo_socio
    WHERE id_socio = p_id_socio;
END;
$$;


ALTER PROCEDURE public.sp_update_socio(IN p_id_socio integer, IN p_tipo_socio character varying) OWNER TO grupo2;

--
-- TOC entry 274 (class 1255 OID 58510)
-- Name: verificar_copia_danada(integer); Type: FUNCTION; Schema: public; Owner: grupo2
--

CREATE FUNCTION public.verificar_copia_danada(id_copia integer) RETURNS boolean
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN EXISTS (SELECT 1 FROM copia WHERE id_copia = id_copia AND estado = 'Dañado');
END;
$$;


ALTER FUNCTION public.verificar_copia_danada(id_copia integer) OWNER TO grupo2;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 248 (class 1259 OID 58379)
-- Name: auditoria_general; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.auditoria_general (
    id_auditoria integer NOT NULL,
    tabla_afectada text NOT NULL,
    operacion text NOT NULL,
    usuario text DEFAULT CURRENT_USER NOT NULL,
    fecha timestamp without time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    datos_anteriores jsonb,
    datos_nuevos jsonb
);


ALTER TABLE public.auditoria_general OWNER TO grupo2;

--
-- TOC entry 247 (class 1259 OID 58378)
-- Name: auditoria_general_id_auditoria_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.auditoria_general_id_auditoria_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.auditoria_general_id_auditoria_seq OWNER TO grupo2;

--
-- TOC entry 3668 (class 0 OID 0)
-- Dependencies: 247
-- Name: auditoria_general_id_auditoria_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.auditoria_general_id_auditoria_seq OWNED BY public.auditoria_general.id_auditoria;


--
-- TOC entry 228 (class 1259 OID 58223)
-- Name: autor; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.autor (
    id_autor integer NOT NULL,
    nombre character varying(100) NOT NULL,
    nacionalidad character varying(50)
);


ALTER TABLE public.autor OWNER TO grupo2;

--
-- TOC entry 227 (class 1259 OID 58222)
-- Name: autor_id_autor_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.autor_id_autor_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.autor_id_autor_seq OWNER TO grupo2;

--
-- TOC entry 3671 (class 0 OID 0)
-- Dependencies: 227
-- Name: autor_id_autor_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.autor_id_autor_seq OWNED BY public.autor.id_autor;


--
-- TOC entry 226 (class 1259 OID 58214)
-- Name: categoria; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.categoria (
    id_categoria integer NOT NULL,
    nombre character varying(100) NOT NULL,
    descripcion text
);


ALTER TABLE public.categoria OWNER TO grupo2;

--
-- TOC entry 225 (class 1259 OID 58213)
-- Name: categoria_id_categoria_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.categoria_id_categoria_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.categoria_id_categoria_seq OWNER TO grupo2;

--
-- TOC entry 3674 (class 0 OID 0)
-- Dependencies: 225
-- Name: categoria_id_categoria_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.categoria_id_categoria_seq OWNED BY public.categoria.id_categoria;


--
-- TOC entry 234 (class 1259 OID 58266)
-- Name: copia; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.copia (
    id_copia integer NOT NULL,
    id_libro integer,
    codigo_barra character varying(50) NOT NULL,
    estado character varying(50) NOT NULL,
    ubicacion text
);


ALTER TABLE public.copia OWNER TO grupo2;

--
-- TOC entry 233 (class 1259 OID 58265)
-- Name: copia_id_copia_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.copia_id_copia_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.copia_id_copia_seq OWNER TO grupo2;

--
-- TOC entry 3677 (class 0 OID 0)
-- Dependencies: 233
-- Name: copia_id_copia_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.copia_id_copia_seq OWNED BY public.copia.id_copia;


--
-- TOC entry 240 (class 1259 OID 58314)
-- Name: devolucion; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.devolucion (
    id_devolucion integer NOT NULL,
    id_prestamo integer,
    fecha_real_devolucion date NOT NULL,
    estado character varying(50) NOT NULL
);


ALTER TABLE public.devolucion OWNER TO grupo2;

--
-- TOC entry 239 (class 1259 OID 58313)
-- Name: devolucion_id_devolucion_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.devolucion_id_devolucion_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.devolucion_id_devolucion_seq OWNER TO grupo2;

--
-- TOC entry 3680 (class 0 OID 0)
-- Dependencies: 239
-- Name: devolucion_id_devolucion_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.devolucion_id_devolucion_seq OWNED BY public.devolucion.id_devolucion;


--
-- TOC entry 224 (class 1259 OID 58207)
-- Name: editorial; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.editorial (
    id_editorial integer NOT NULL,
    nombre character varying(100) NOT NULL
);


ALTER TABLE public.editorial OWNER TO grupo2;

--
-- TOC entry 223 (class 1259 OID 58206)
-- Name: editorial_id_editorial_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.editorial_id_editorial_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.editorial_id_editorial_seq OWNER TO grupo2;

--
-- TOC entry 3683 (class 0 OID 0)
-- Dependencies: 223
-- Name: editorial_id_editorial_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.editorial_id_editorial_seq OWNED BY public.editorial.id_editorial;


--
-- TOC entry 246 (class 1259 OID 58360)
-- Name: historial_prestamo; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.historial_prestamo (
    id_historial integer NOT NULL,
    id_socio integer,
    id_copia integer,
    fecha_prestamo date NOT NULL,
    fecha_devolucion date,
    observaciones text
);


ALTER TABLE public.historial_prestamo OWNER TO grupo2;

--
-- TOC entry 245 (class 1259 OID 58359)
-- Name: historial_prestamo_id_historial_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.historial_prestamo_id_historial_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.historial_prestamo_id_historial_seq OWNER TO grupo2;

--
-- TOC entry 3686 (class 0 OID 0)
-- Dependencies: 245
-- Name: historial_prestamo_id_historial_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.historial_prestamo_id_historial_seq OWNED BY public.historial_prestamo.id_historial;


--
-- TOC entry 236 (class 1259 OID 58282)
-- Name: inventario; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.inventario (
    id_inventario integer NOT NULL,
    id_libro integer,
    cantidad integer NOT NULL,
    CONSTRAINT inventario_cantidad_check CHECK ((cantidad >= 0))
);


ALTER TABLE public.inventario OWNER TO grupo2;

--
-- TOC entry 235 (class 1259 OID 58281)
-- Name: inventario_id_inventario_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.inventario_id_inventario_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.inventario_id_inventario_seq OWNER TO grupo2;

--
-- TOC entry 3689 (class 0 OID 0)
-- Dependencies: 235
-- Name: inventario_id_inventario_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.inventario_id_inventario_seq OWNED BY public.inventario.id_inventario;


--
-- TOC entry 230 (class 1259 OID 58230)
-- Name: libro; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.libro (
    id_libro integer NOT NULL,
    titulo character varying(200) NOT NULL,
    id_editorial integer,
    id_categoria integer
);


ALTER TABLE public.libro OWNER TO grupo2;

--
-- TOC entry 232 (class 1259 OID 58247)
-- Name: libro_autor; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.libro_autor (
    id_libro_autor integer NOT NULL,
    id_libro integer,
    id_autor integer
);


ALTER TABLE public.libro_autor OWNER TO grupo2;

--
-- TOC entry 231 (class 1259 OID 58246)
-- Name: libro_autor_id_libro_autor_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.libro_autor_id_libro_autor_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.libro_autor_id_libro_autor_seq OWNER TO grupo2;

--
-- TOC entry 3693 (class 0 OID 0)
-- Dependencies: 231
-- Name: libro_autor_id_libro_autor_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.libro_autor_id_libro_autor_seq OWNED BY public.libro_autor.id_libro_autor;


--
-- TOC entry 229 (class 1259 OID 58229)
-- Name: libro_id_libro_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.libro_id_libro_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.libro_id_libro_seq OWNER TO grupo2;

--
-- TOC entry 3695 (class 0 OID 0)
-- Dependencies: 229
-- Name: libro_id_libro_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.libro_id_libro_seq OWNED BY public.libro.id_libro;


--
-- TOC entry 244 (class 1259 OID 58345)
-- Name: multa; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.multa (
    id_multa integer NOT NULL,
    id_socio integer,
    monto numeric(10,2) NOT NULL,
    motivo text,
    fecha date NOT NULL,
    estado character varying(50) NOT NULL,
    id_prestamo integer,
    CONSTRAINT multa_monto_check CHECK ((monto >= (0)::numeric))
);


ALTER TABLE public.multa OWNER TO grupo2;

--
-- TOC entry 243 (class 1259 OID 58344)
-- Name: multa_id_multa_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.multa_id_multa_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.multa_id_multa_seq OWNER TO grupo2;

--
-- TOC entry 3698 (class 0 OID 0)
-- Dependencies: 243
-- Name: multa_id_multa_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.multa_id_multa_seq OWNED BY public.multa.id_multa;


--
-- TOC entry 218 (class 1259 OID 58168)
-- Name: persona; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.persona (
    id_persona integer NOT NULL,
    nombre character varying(100) NOT NULL,
    apellido character varying(100) NOT NULL,
    correo character varying(100),
    telefono character varying(20),
    direccion text
);


ALTER TABLE public.persona OWNER TO grupo2;

--
-- TOC entry 217 (class 1259 OID 58167)
-- Name: persona_id_persona_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.persona_id_persona_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.persona_id_persona_seq OWNER TO grupo2;

--
-- TOC entry 3701 (class 0 OID 0)
-- Dependencies: 217
-- Name: persona_id_persona_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.persona_id_persona_seq OWNED BY public.persona.id_persona;


--
-- TOC entry 222 (class 1259 OID 58193)
-- Name: personal_biblioteca; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.personal_biblioteca (
    id_personal integer NOT NULL,
    id_persona integer,
    rol character varying(100) NOT NULL
);


ALTER TABLE public.personal_biblioteca OWNER TO grupo2;

--
-- TOC entry 221 (class 1259 OID 58192)
-- Name: personal_biblioteca_id_personal_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.personal_biblioteca_id_personal_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.personal_biblioteca_id_personal_seq OWNER TO grupo2;

--
-- TOC entry 3704 (class 0 OID 0)
-- Dependencies: 221
-- Name: personal_biblioteca_id_personal_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.personal_biblioteca_id_personal_seq OWNED BY public.personal_biblioteca.id_personal;


--
-- TOC entry 238 (class 1259 OID 58297)
-- Name: prestamo; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.prestamo (
    id_prestamo integer NOT NULL,
    id_socio integer,
    id_copia integer,
    fecha_prestamo date NOT NULL,
    fecha_devolucion_esperada date NOT NULL
);


ALTER TABLE public.prestamo OWNER TO grupo2;

--
-- TOC entry 237 (class 1259 OID 58296)
-- Name: prestamo_id_prestamo_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.prestamo_id_prestamo_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.prestamo_id_prestamo_seq OWNER TO grupo2;

--
-- TOC entry 3707 (class 0 OID 0)
-- Dependencies: 237
-- Name: prestamo_id_prestamo_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.prestamo_id_prestamo_seq OWNED BY public.prestamo.id_prestamo;


--
-- TOC entry 242 (class 1259 OID 58328)
-- Name: reserva; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.reserva (
    id_reserva integer NOT NULL,
    id_socio integer,
    id_copia integer,
    fecha_reserva date NOT NULL,
    estado character varying(50) NOT NULL
);


ALTER TABLE public.reserva OWNER TO grupo2;

--
-- TOC entry 241 (class 1259 OID 58327)
-- Name: reserva_id_reserva_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.reserva_id_reserva_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.reserva_id_reserva_seq OWNER TO grupo2;

--
-- TOC entry 3710 (class 0 OID 0)
-- Dependencies: 241
-- Name: reserva_id_reserva_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.reserva_id_reserva_seq OWNED BY public.reserva.id_reserva;


--
-- TOC entry 220 (class 1259 OID 58179)
-- Name: socio; Type: TABLE; Schema: public; Owner: grupo2
--

CREATE TABLE public.socio (
    id_socio integer NOT NULL,
    id_persona integer,
    tipo_socio character varying(50) NOT NULL
);


ALTER TABLE public.socio OWNER TO grupo2;

--
-- TOC entry 219 (class 1259 OID 58178)
-- Name: socio_id_socio_seq; Type: SEQUENCE; Schema: public; Owner: grupo2
--

CREATE SEQUENCE public.socio_id_socio_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.socio_id_socio_seq OWNER TO grupo2;

--
-- TOC entry 3713 (class 0 OID 0)
-- Dependencies: 219
-- Name: socio_id_socio_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: grupo2
--

ALTER SEQUENCE public.socio_id_socio_seq OWNED BY public.socio.id_socio;


--
-- TOC entry 251 (class 1259 OID 58437)
-- Name: vista_copias_disponibles_por_titulo; Type: VIEW; Schema: public; Owner: grupo2
--

CREATE VIEW public.vista_copias_disponibles_por_titulo AS
 SELECT l.titulo,
    count(c.id_copia) AS cantidad_disponible
   FROM (public.copia c
     JOIN public.libro l ON ((c.id_libro = l.id_libro)))
  WHERE ((c.estado)::text = 'Disponible'::text)
  GROUP BY l.titulo
  ORDER BY (count(c.id_copia)) DESC;


ALTER VIEW public.vista_copias_disponibles_por_titulo OWNER TO grupo2;

--
-- TOC entry 253 (class 1259 OID 58446)
-- Name: vista_historial_prestamos_por_socio; Type: VIEW; Schema: public; Owner: grupo2
--

CREATE VIEW public.vista_historial_prestamos_por_socio AS
 SELECT hp.id_historial,
    s.id_socio,
    (((pe.nombre)::text || ' '::text) || (pe.apellido)::text) AS nombre_socio,
    l.titulo AS titulo_libro,
    hp.fecha_prestamo,
    hp.fecha_devolucion,
    hp.observaciones
   FROM ((((public.historial_prestamo hp
     JOIN public.socio s ON ((hp.id_socio = s.id_socio)))
     JOIN public.persona pe ON ((s.id_persona = pe.id_persona)))
     JOIN public.copia c ON ((hp.id_copia = c.id_copia)))
     JOIN public.libro l ON ((c.id_libro = l.id_libro)))
  ORDER BY hp.fecha_prestamo DESC;


ALTER VIEW public.vista_historial_prestamos_por_socio OWNER TO grupo2;

--
-- TOC entry 249 (class 1259 OID 58427)
-- Name: vista_libros_prestados; Type: VIEW; Schema: public; Owner: grupo2
--

CREATE VIEW public.vista_libros_prestados AS
 SELECT p.id_prestamo,
    l.titulo AS titulo_libro,
    c.codigo_barra,
    s.id_socio,
    (((pe.nombre)::text || ' '::text) || (pe.apellido)::text) AS nombre_socio,
    p.fecha_prestamo,
    p.fecha_devolucion_esperada
   FROM ((((public.prestamo p
     JOIN public.copia c ON ((p.id_copia = c.id_copia)))
     JOIN public.libro l ON ((c.id_libro = l.id_libro)))
     JOIN public.socio s ON ((p.id_socio = s.id_socio)))
     JOIN public.persona pe ON ((s.id_persona = pe.id_persona)))
  WHERE (NOT (EXISTS ( SELECT 1
           FROM public.devolucion d
          WHERE (d.id_prestamo = p.id_prestamo))));


ALTER VIEW public.vista_libros_prestados OWNER TO grupo2;

--
-- TOC entry 252 (class 1259 OID 58441)
-- Name: vista_reservas_activas; Type: VIEW; Schema: public; Owner: grupo2
--

CREATE VIEW public.vista_reservas_activas AS
 SELECT r.id_reserva,
    l.titulo AS titulo_libro,
    c.codigo_barra,
    s.id_socio,
    (((pe.nombre)::text || ' '::text) || (pe.apellido)::text) AS nombre_socio,
    r.fecha_reserva
   FROM ((((public.reserva r
     JOIN public.copia c ON ((r.id_copia = c.id_copia)))
     JOIN public.libro l ON ((c.id_libro = l.id_libro)))
     JOIN public.socio s ON ((r.id_socio = s.id_socio)))
     JOIN public.persona pe ON ((s.id_persona = pe.id_persona)))
  WHERE ((r.estado)::text = 'Activa'::text);


ALTER VIEW public.vista_reservas_activas OWNER TO grupo2;

--
-- TOC entry 250 (class 1259 OID 58432)
-- Name: vista_socios_con_multas_pendientes; Type: VIEW; Schema: public; Owner: grupo2
--

CREATE VIEW public.vista_socios_con_multas_pendientes AS
 SELECT m.id_multa,
    s.id_socio,
    (((pe.nombre)::text || ' '::text) || (pe.apellido)::text) AS nombre_socio,
    m.monto,
    m.motivo,
    m.fecha
   FROM ((public.multa m
     JOIN public.socio s ON ((m.id_socio = s.id_socio)))
     JOIN public.persona pe ON ((s.id_persona = pe.id_persona)))
  WHERE ((m.estado)::text = 'Pendiente'::text);


ALTER VIEW public.vista_socios_con_multas_pendientes OWNER TO grupo2;

--
-- TOC entry 3375 (class 2604 OID 58382)
-- Name: auditoria_general id_auditoria; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.auditoria_general ALTER COLUMN id_auditoria SET DEFAULT nextval('public.auditoria_general_id_auditoria_seq'::regclass);


--
-- TOC entry 3365 (class 2604 OID 58226)
-- Name: autor id_autor; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.autor ALTER COLUMN id_autor SET DEFAULT nextval('public.autor_id_autor_seq'::regclass);


--
-- TOC entry 3364 (class 2604 OID 58217)
-- Name: categoria id_categoria; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.categoria ALTER COLUMN id_categoria SET DEFAULT nextval('public.categoria_id_categoria_seq'::regclass);


--
-- TOC entry 3368 (class 2604 OID 58269)
-- Name: copia id_copia; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.copia ALTER COLUMN id_copia SET DEFAULT nextval('public.copia_id_copia_seq'::regclass);


--
-- TOC entry 3371 (class 2604 OID 58317)
-- Name: devolucion id_devolucion; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.devolucion ALTER COLUMN id_devolucion SET DEFAULT nextval('public.devolucion_id_devolucion_seq'::regclass);


--
-- TOC entry 3363 (class 2604 OID 58210)
-- Name: editorial id_editorial; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.editorial ALTER COLUMN id_editorial SET DEFAULT nextval('public.editorial_id_editorial_seq'::regclass);


--
-- TOC entry 3374 (class 2604 OID 58363)
-- Name: historial_prestamo id_historial; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.historial_prestamo ALTER COLUMN id_historial SET DEFAULT nextval('public.historial_prestamo_id_historial_seq'::regclass);


--
-- TOC entry 3369 (class 2604 OID 58285)
-- Name: inventario id_inventario; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.inventario ALTER COLUMN id_inventario SET DEFAULT nextval('public.inventario_id_inventario_seq'::regclass);


--
-- TOC entry 3366 (class 2604 OID 58233)
-- Name: libro id_libro; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro ALTER COLUMN id_libro SET DEFAULT nextval('public.libro_id_libro_seq'::regclass);


--
-- TOC entry 3367 (class 2604 OID 58250)
-- Name: libro_autor id_libro_autor; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro_autor ALTER COLUMN id_libro_autor SET DEFAULT nextval('public.libro_autor_id_libro_autor_seq'::regclass);


--
-- TOC entry 3373 (class 2604 OID 58348)
-- Name: multa id_multa; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.multa ALTER COLUMN id_multa SET DEFAULT nextval('public.multa_id_multa_seq'::regclass);


--
-- TOC entry 3360 (class 2604 OID 58171)
-- Name: persona id_persona; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.persona ALTER COLUMN id_persona SET DEFAULT nextval('public.persona_id_persona_seq'::regclass);


--
-- TOC entry 3362 (class 2604 OID 58196)
-- Name: personal_biblioteca id_personal; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.personal_biblioteca ALTER COLUMN id_personal SET DEFAULT nextval('public.personal_biblioteca_id_personal_seq'::regclass);


--
-- TOC entry 3370 (class 2604 OID 58300)
-- Name: prestamo id_prestamo; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.prestamo ALTER COLUMN id_prestamo SET DEFAULT nextval('public.prestamo_id_prestamo_seq'::regclass);


--
-- TOC entry 3372 (class 2604 OID 58331)
-- Name: reserva id_reserva; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.reserva ALTER COLUMN id_reserva SET DEFAULT nextval('public.reserva_id_reserva_seq'::regclass);


--
-- TOC entry 3361 (class 2604 OID 58182)
-- Name: socio id_socio; Type: DEFAULT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.socio ALTER COLUMN id_socio SET DEFAULT nextval('public.socio_id_socio_seq'::regclass);


--
-- TOC entry 3661 (class 0 OID 58379)
-- Dependencies: 248
-- Data for Name: auditoria_general; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.auditoria_general (id_auditoria, tabla_afectada, operacion, usuario, fecha, datos_anteriores, datos_nuevos) FROM stdin;
1	socio	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_socio": 1, "id_persona": 1, "tipo_socio": "Estudiante"}
2	socio	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_socio": 2, "id_persona": 2, "tipo_socio": "Profesor"}
3	socio	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_socio": 3, "id_persona": 3, "tipo_socio": "Administrativo"}
4	socio	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_socio": 4, "id_persona": 4, "tipo_socio": "Externo"}
5	socio	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_socio": 5, "id_persona": 5, "tipo_socio": "Estudiante"}
6	editorial	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Editorial Alfa", "id_editorial": 1}
7	editorial	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Editorial Beta", "id_editorial": 2}
8	editorial	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Editorial Gama", "id_editorial": 3}
9	editorial	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Editorial Delta", "id_editorial": 4}
10	editorial	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Editorial Omega", "id_editorial": 5}
11	categoria	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Ficción", "descripcion": "Obras de narrativa imaginaria", "id_categoria": 1}
12	categoria	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Ciencia", "descripcion": "Libros científicos y técnicos", "id_categoria": 2}
13	categoria	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Historia", "descripcion": "Libros históricos", "id_categoria": 3}
14	categoria	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Arte", "descripcion": "Obras relacionadas al arte", "id_categoria": 4}
15	categoria	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Tecnología", "descripcion": "Libros sobre tecnología y computación", "id_categoria": 5}
16	autor	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Gabriel García Márquez", "id_autor": 1, "nacionalidad": "Colombiana"}
17	autor	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Isabel Allende", "id_autor": 2, "nacionalidad": "Chilena"}
18	autor	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Mario Vargas Llosa", "id_autor": 3, "nacionalidad": "Peruana"}
19	autor	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "Julio Cortázar", "id_autor": 4, "nacionalidad": "Argentina"}
20	autor	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"nombre": "J.K. Rowling", "id_autor": 5, "nacionalidad": "Británica"}
21	libro	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"titulo": "Cien Años de Soledad", "id_libro": 1, "id_categoria": 1, "id_editorial": 1}
22	libro	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"titulo": "La Casa de los Espíritus", "id_libro": 2, "id_categoria": 1, "id_editorial": 2}
23	libro	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"titulo": "La Ciudad y los Perros", "id_libro": 3, "id_categoria": 1, "id_editorial": 3}
24	libro	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"titulo": "Rayuela", "id_libro": 4, "id_categoria": 1, "id_editorial": 4}
25	libro	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"titulo": "Harry Potter y la Piedra Filosofal", "id_libro": 5, "id_categoria": 1, "id_editorial": 5}
26	copia	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Disponible", "id_copia": 1, "id_libro": 1, "ubicacion": "Estante A1", "codigo_barra": "CB001"}
27	copia	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Disponible", "id_copia": 2, "id_libro": 2, "ubicacion": "Estante A2", "codigo_barra": "CB002"}
28	copia	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Prestado", "id_copia": 3, "id_libro": 3, "ubicacion": "Estante A3", "codigo_barra": "CB003"}
29	copia	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Reservado", "id_copia": 4, "id_libro": 4, "ubicacion": "Estante A4", "codigo_barra": "CB004"}
30	copia	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Dañado", "id_copia": 5, "id_libro": 5, "ubicacion": "Bodega", "codigo_barra": "CB005"}
31	prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 1, "id_socio": 1, "id_prestamo": 1, "fecha_prestamo": "2025-04-20", "fecha_devolucion_esperada": "2025-05-04"}
32	prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 2, "id_socio": 2, "id_prestamo": 2, "fecha_prestamo": "2025-04-21", "fecha_devolucion_esperada": "2025-05-05"}
33	prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 3, "id_socio": 3, "id_prestamo": 3, "fecha_prestamo": "2025-04-22", "fecha_devolucion_esperada": "2025-05-06"}
34	prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 4, "id_socio": 4, "id_prestamo": 4, "fecha_prestamo": "2025-04-23", "fecha_devolucion_esperada": "2025-05-07"}
35	prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 5, "id_socio": 5, "id_prestamo": 5, "fecha_prestamo": "2025-04-24", "fecha_devolucion_esperada": "2025-05-08"}
36	reserva	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Activa", "id_copia": 2, "id_socio": 1, "id_reserva": 1, "fecha_reserva": "2025-04-25"}
37	historial_prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 2, "id_socio": 1, "id_historial": 1, "observaciones": "Reserva creada automáticamente", "fecha_prestamo": "2025-04-25", "fecha_devolucion": null}
38	reserva	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Cancelada", "id_copia": 3, "id_socio": 2, "id_reserva": 2, "fecha_reserva": "2025-04-26"}
39	historial_prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 3, "id_socio": 2, "id_historial": 2, "observaciones": "Reserva creada automáticamente", "fecha_prestamo": "2025-04-26", "fecha_devolucion": null}
40	reserva	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Expirada", "id_copia": 4, "id_socio": 3, "id_reserva": 3, "fecha_reserva": "2025-04-27"}
41	historial_prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 4, "id_socio": 3, "id_historial": 3, "observaciones": "Reserva creada automáticamente", "fecha_prestamo": "2025-04-27", "fecha_devolucion": null}
42	reserva	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Activa", "id_copia": 5, "id_socio": 4, "id_reserva": 4, "fecha_reserva": "2025-04-28"}
43	historial_prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 5, "id_socio": 4, "id_historial": 4, "observaciones": "Reserva creada automáticamente", "fecha_prestamo": "2025-04-28", "fecha_devolucion": null}
44	reserva	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"estado": "Activa", "id_copia": 1, "id_socio": 5, "id_reserva": 5, "fecha_reserva": "2025-04-29"}
45	historial_prestamo	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"id_copia": 1, "id_socio": 5, "id_historial": 5, "observaciones": "Reserva creada automáticamente", "fecha_prestamo": "2025-04-29", "fecha_devolucion": null}
46	multa	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"fecha": "2025-05-10", "monto": 5000.00, "estado": "Pendiente", "motivo": "Retraso en devolución", "id_multa": 1, "id_socio": 1}
47	multa	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"fecha": "2025-05-11", "monto": 7000.00, "estado": "Pendiente", "motivo": "Pérdida de libro", "id_multa": 2, "id_socio": 2}
48	multa	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"fecha": "2025-05-12", "monto": 2000.00, "estado": "Pagada", "motivo": "Retraso leve", "id_multa": 3, "id_socio": 3}
49	multa	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"fecha": "2025-05-13", "monto": 3000.00, "estado": "Pendiente", "motivo": "Daño físico", "id_multa": 4, "id_socio": 4}
50	multa	INSERT	grupo2	2025-04-28 17:50:53.012477	\N	{"fecha": "2025-05-14", "monto": 1000.00, "estado": "Pagada", "motivo": "Retraso en devolución", "id_multa": 5, "id_socio": 5}
51	prestamo	INSERT	grupo2	2025-04-30 18:03:48.973659	\N	{"id_copia": 1, "id_socio": 1, "id_prestamo": 6, "fecha_prestamo": "2025-04-10", "fecha_devolucion_esperada": "2025-04-17"}
52	prestamo	INSERT	grupo2	2025-04-30 18:03:48.973659	\N	{"id_copia": 2, "id_socio": 2, "id_prestamo": 7, "fecha_prestamo": "2025-04-12", "fecha_devolucion_esperada": "2025-04-19"}
53	prestamo	INSERT	grupo2	2025-04-30 18:03:48.973659	\N	{"id_copia": 3, "id_socio": 3, "id_prestamo": 8, "fecha_prestamo": "2025-04-13", "fecha_devolucion_esperada": "2025-04-18"}
54	prestamo	INSERT	grupo2	2025-04-30 18:03:48.973659	\N	{"id_copia": 4, "id_socio": 4, "id_prestamo": 9, "fecha_prestamo": "2025-04-14", "fecha_devolucion_esperada": "2025-04-19"}
55	prestamo	INSERT	grupo2	2025-04-30 18:03:48.973659	\N	{"id_copia": 5, "id_socio": 5, "id_prestamo": 10, "fecha_prestamo": "2025-04-15", "fecha_devolucion_esperada": "2025-04-20"}
56	multa	INSERT	grupo2	2025-04-30 18:10:14.986955	\N	{"fecha": "2025-04-30", "monto": 60.00, "estado": "Pendiente", "motivo": "Retraso en la devolución del préstamo", "id_multa": 6, "id_socio": 3, "id_prestamo": null}
57	multa	INSERT	grupo2	2025-04-30 18:10:14.986955	\N	{"fecha": "2025-04-30", "monto": 50.00, "estado": "Pendiente", "motivo": "Retraso en la devolución del préstamo", "id_multa": 7, "id_socio": 5, "id_prestamo": null}
58	prestamo	DELETE	grupo2	2025-04-30 18:32:01.705889	{"id_copia": 2, "id_socio": 2, "id_prestamo": 7, "fecha_prestamo": "2025-04-12", "fecha_devolucion_esperada": "2025-04-19"}	\N
\.


--
-- TOC entry 3641 (class 0 OID 58223)
-- Dependencies: 228
-- Data for Name: autor; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.autor (id_autor, nombre, nacionalidad) FROM stdin;
1	Gabriel García Márquez	Colombiana
2	Isabel Allende	Chilena
3	Mario Vargas Llosa	Peruana
4	Julio Cortázar	Argentina
5	J.K. Rowling	Británica
\.


--
-- TOC entry 3639 (class 0 OID 58214)
-- Dependencies: 226
-- Data for Name: categoria; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.categoria (id_categoria, nombre, descripcion) FROM stdin;
1	Ficción	Obras de narrativa imaginaria
2	Ciencia	Libros científicos y técnicos
3	Historia	Libros históricos
4	Arte	Obras relacionadas al arte
5	Tecnología	Libros sobre tecnología y computación
\.


--
-- TOC entry 3647 (class 0 OID 58266)
-- Dependencies: 234
-- Data for Name: copia; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.copia (id_copia, id_libro, codigo_barra, estado, ubicacion) FROM stdin;
1	1	CB001	Disponible	Estante A1
2	2	CB002	Disponible	Estante A2
3	3	CB003	Prestado	Estante A3
4	4	CB004	Reservado	Estante A4
5	5	CB005	Dañado	Bodega
\.


--
-- TOC entry 3653 (class 0 OID 58314)
-- Dependencies: 240
-- Data for Name: devolucion; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.devolucion (id_devolucion, id_prestamo, fecha_real_devolucion, estado) FROM stdin;
1	1	2025-05-03	A tiempo
2	2	2025-05-06	Retrasada
3	3	2025-05-05	A tiempo
4	4	2025-05-09	Retrasada
5	5	2025-05-07	A tiempo
\.


--
-- TOC entry 3637 (class 0 OID 58207)
-- Dependencies: 224
-- Data for Name: editorial; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.editorial (id_editorial, nombre) FROM stdin;
1	Editorial Alfa
2	Editorial Beta
3	Editorial Gama
4	Editorial Delta
5	Editorial Omega
\.


--
-- TOC entry 3659 (class 0 OID 58360)
-- Dependencies: 246
-- Data for Name: historial_prestamo; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.historial_prestamo (id_historial, id_socio, id_copia, fecha_prestamo, fecha_devolucion, observaciones) FROM stdin;
1	1	2	2025-04-25	\N	Reserva creada automáticamente
2	2	3	2025-04-26	\N	Reserva creada automáticamente
3	3	4	2025-04-27	\N	Reserva creada automáticamente
4	4	5	2025-04-28	\N	Reserva creada automáticamente
5	5	1	2025-04-29	\N	Reserva creada automáticamente
\.


--
-- TOC entry 3649 (class 0 OID 58282)
-- Dependencies: 236
-- Data for Name: inventario; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.inventario (id_inventario, id_libro, cantidad) FROM stdin;
1	1	5
2	2	3
3	3	2
4	4	4
5	5	6
\.


--
-- TOC entry 3643 (class 0 OID 58230)
-- Dependencies: 230
-- Data for Name: libro; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.libro (id_libro, titulo, id_editorial, id_categoria) FROM stdin;
1	Cien Años de Soledad	1	1
2	La Casa de los Espíritus	2	1
3	La Ciudad y los Perros	3	1
4	Rayuela	4	1
5	Harry Potter y la Piedra Filosofal	5	1
\.


--
-- TOC entry 3645 (class 0 OID 58247)
-- Dependencies: 232
-- Data for Name: libro_autor; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.libro_autor (id_libro_autor, id_libro, id_autor) FROM stdin;
1	1	1
2	2	2
3	3	3
4	4	4
5	5	5
\.


--
-- TOC entry 3657 (class 0 OID 58345)
-- Dependencies: 244
-- Data for Name: multa; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.multa (id_multa, id_socio, monto, motivo, fecha, estado, id_prestamo) FROM stdin;
1	1	5000.00	Retraso en devolución	2025-05-10	Pendiente	\N
2	2	7000.00	Pérdida de libro	2025-05-11	Pendiente	\N
3	3	2000.00	Retraso leve	2025-05-12	Pagada	\N
4	4	3000.00	Daño físico	2025-05-13	Pendiente	\N
5	5	1000.00	Retraso en devolución	2025-05-14	Pagada	\N
6	3	60.00	Retraso en la devolución del préstamo	2025-04-30	Pendiente	\N
7	5	50.00	Retraso en la devolución del préstamo	2025-04-30	Pendiente	\N
\.


--
-- TOC entry 3631 (class 0 OID 58168)
-- Dependencies: 218
-- Data for Name: persona; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.persona (id_persona, nombre, apellido, correo, telefono, direccion) FROM stdin;
1	Juan	Pérez	juan.perez@mail.com	123456789	Calle 123
2	María	Gómez	maria.gomez@mail.com	987654321	Carrera 45
3	Carlos	Ramírez	carlos.ramirez@mail.com	111222333	Avenida 10
4	Ana	Martínez	ana.martinez@mail.com	444555666	Transversal 9
5	Laura	Fernández	laura.fernandez@mail.com	777888999	Diagonal 3
\.


--
-- TOC entry 3635 (class 0 OID 58193)
-- Dependencies: 222
-- Data for Name: personal_biblioteca; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.personal_biblioteca (id_personal, id_persona, rol) FROM stdin;
1	1	Bibliotecario
2	2	Asistente de sala
3	3	Catalogador
4	4	Auxiliar de préstamo
5	5	Jefe de Biblioteca
\.


--
-- TOC entry 3651 (class 0 OID 58297)
-- Dependencies: 238
-- Data for Name: prestamo; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.prestamo (id_prestamo, id_socio, id_copia, fecha_prestamo, fecha_devolucion_esperada) FROM stdin;
1	1	1	2025-04-20	2025-05-04
2	2	2	2025-04-21	2025-05-05
3	3	3	2025-04-22	2025-05-06
4	4	4	2025-04-23	2025-05-07
5	5	5	2025-04-24	2025-05-08
6	1	1	2025-04-10	2025-04-17
8	3	3	2025-04-13	2025-04-18
9	4	4	2025-04-14	2025-04-19
10	5	5	2025-04-15	2025-04-20
\.


--
-- TOC entry 3655 (class 0 OID 58328)
-- Dependencies: 242
-- Data for Name: reserva; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.reserva (id_reserva, id_socio, id_copia, fecha_reserva, estado) FROM stdin;
1	1	2	2025-04-25	Activa
2	2	3	2025-04-26	Cancelada
3	3	4	2025-04-27	Expirada
4	4	5	2025-04-28	Activa
5	5	1	2025-04-29	Activa
\.


--
-- TOC entry 3633 (class 0 OID 58179)
-- Dependencies: 220
-- Data for Name: socio; Type: TABLE DATA; Schema: public; Owner: grupo2
--

COPY public.socio (id_socio, id_persona, tipo_socio) FROM stdin;
1	1	Estudiante
2	2	Profesor
3	3	Administrativo
4	4	Externo
5	5	Estudiante
\.


--
-- TOC entry 3720 (class 0 OID 0)
-- Dependencies: 247
-- Name: auditoria_general_id_auditoria_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.auditoria_general_id_auditoria_seq', 58, true);


--
-- TOC entry 3721 (class 0 OID 0)
-- Dependencies: 227
-- Name: autor_id_autor_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.autor_id_autor_seq', 5, true);


--
-- TOC entry 3722 (class 0 OID 0)
-- Dependencies: 225
-- Name: categoria_id_categoria_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.categoria_id_categoria_seq', 5, true);


--
-- TOC entry 3723 (class 0 OID 0)
-- Dependencies: 233
-- Name: copia_id_copia_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.copia_id_copia_seq', 5, true);


--
-- TOC entry 3724 (class 0 OID 0)
-- Dependencies: 239
-- Name: devolucion_id_devolucion_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.devolucion_id_devolucion_seq', 5, true);


--
-- TOC entry 3725 (class 0 OID 0)
-- Dependencies: 223
-- Name: editorial_id_editorial_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.editorial_id_editorial_seq', 5, true);


--
-- TOC entry 3726 (class 0 OID 0)
-- Dependencies: 245
-- Name: historial_prestamo_id_historial_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.historial_prestamo_id_historial_seq', 5, true);


--
-- TOC entry 3727 (class 0 OID 0)
-- Dependencies: 235
-- Name: inventario_id_inventario_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.inventario_id_inventario_seq', 5, true);


--
-- TOC entry 3728 (class 0 OID 0)
-- Dependencies: 231
-- Name: libro_autor_id_libro_autor_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.libro_autor_id_libro_autor_seq', 5, true);


--
-- TOC entry 3729 (class 0 OID 0)
-- Dependencies: 229
-- Name: libro_id_libro_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.libro_id_libro_seq', 5, true);


--
-- TOC entry 3730 (class 0 OID 0)
-- Dependencies: 243
-- Name: multa_id_multa_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.multa_id_multa_seq', 7, true);


--
-- TOC entry 3731 (class 0 OID 0)
-- Dependencies: 217
-- Name: persona_id_persona_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.persona_id_persona_seq', 5, true);


--
-- TOC entry 3732 (class 0 OID 0)
-- Dependencies: 221
-- Name: personal_biblioteca_id_personal_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.personal_biblioteca_id_personal_seq', 5, true);


--
-- TOC entry 3733 (class 0 OID 0)
-- Dependencies: 237
-- Name: prestamo_id_prestamo_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.prestamo_id_prestamo_seq', 10, true);


--
-- TOC entry 3734 (class 0 OID 0)
-- Dependencies: 241
-- Name: reserva_id_reserva_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.reserva_id_reserva_seq', 5, true);


--
-- TOC entry 3735 (class 0 OID 0)
-- Dependencies: 219
-- Name: socio_id_socio_seq; Type: SEQUENCE SET; Schema: public; Owner: grupo2
--

SELECT pg_catalog.setval('public.socio_id_socio_seq', 5, true);


--
-- TOC entry 3450 (class 2606 OID 58388)
-- Name: auditoria_general auditoria_general_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.auditoria_general
    ADD CONSTRAINT auditoria_general_pkey PRIMARY KEY (id_auditoria);


--
-- TOC entry 3404 (class 2606 OID 58228)
-- Name: autor autor_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.autor
    ADD CONSTRAINT autor_pkey PRIMARY KEY (id_autor);


--
-- TOC entry 3401 (class 2606 OID 58221)
-- Name: categoria categoria_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.categoria
    ADD CONSTRAINT categoria_pkey PRIMARY KEY (id_categoria);


--
-- TOC entry 3418 (class 2606 OID 58275)
-- Name: copia copia_codigo_barra_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.copia
    ADD CONSTRAINT copia_codigo_barra_key UNIQUE (codigo_barra);


--
-- TOC entry 3420 (class 2606 OID 58273)
-- Name: copia copia_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.copia
    ADD CONSTRAINT copia_pkey PRIMARY KEY (id_copia);


--
-- TOC entry 3432 (class 2606 OID 58321)
-- Name: devolucion devolucion_id_prestamo_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.devolucion
    ADD CONSTRAINT devolucion_id_prestamo_key UNIQUE (id_prestamo);


--
-- TOC entry 3434 (class 2606 OID 58319)
-- Name: devolucion devolucion_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.devolucion
    ADD CONSTRAINT devolucion_pkey PRIMARY KEY (id_devolucion);


--
-- TOC entry 3398 (class 2606 OID 58212)
-- Name: editorial editorial_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.editorial
    ADD CONSTRAINT editorial_pkey PRIMARY KEY (id_editorial);


--
-- TOC entry 3446 (class 2606 OID 58367)
-- Name: historial_prestamo historial_prestamo_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.historial_prestamo
    ADD CONSTRAINT historial_prestamo_pkey PRIMARY KEY (id_historial);


--
-- TOC entry 3424 (class 2606 OID 58290)
-- Name: inventario inventario_id_libro_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.inventario
    ADD CONSTRAINT inventario_id_libro_key UNIQUE (id_libro);


--
-- TOC entry 3426 (class 2606 OID 58288)
-- Name: inventario inventario_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.inventario
    ADD CONSTRAINT inventario_pkey PRIMARY KEY (id_inventario);


--
-- TOC entry 3414 (class 2606 OID 58254)
-- Name: libro_autor libro_autor_id_libro_id_autor_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro_autor
    ADD CONSTRAINT libro_autor_id_libro_id_autor_key UNIQUE (id_libro, id_autor);


--
-- TOC entry 3416 (class 2606 OID 58252)
-- Name: libro_autor libro_autor_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro_autor
    ADD CONSTRAINT libro_autor_pkey PRIMARY KEY (id_libro_autor);


--
-- TOC entry 3410 (class 2606 OID 58235)
-- Name: libro libro_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro
    ADD CONSTRAINT libro_pkey PRIMARY KEY (id_libro);


--
-- TOC entry 3444 (class 2606 OID 58353)
-- Name: multa multa_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.multa
    ADD CONSTRAINT multa_pkey PRIMARY KEY (id_multa);


--
-- TOC entry 3384 (class 2606 OID 58177)
-- Name: persona persona_correo_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.persona
    ADD CONSTRAINT persona_correo_key UNIQUE (correo);


--
-- TOC entry 3386 (class 2606 OID 58175)
-- Name: persona persona_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.persona
    ADD CONSTRAINT persona_pkey PRIMARY KEY (id_persona);


--
-- TOC entry 3394 (class 2606 OID 58200)
-- Name: personal_biblioteca personal_biblioteca_id_persona_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.personal_biblioteca
    ADD CONSTRAINT personal_biblioteca_id_persona_key UNIQUE (id_persona);


--
-- TOC entry 3396 (class 2606 OID 58198)
-- Name: personal_biblioteca personal_biblioteca_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.personal_biblioteca
    ADD CONSTRAINT personal_biblioteca_pkey PRIMARY KEY (id_personal);


--
-- TOC entry 3430 (class 2606 OID 58302)
-- Name: prestamo prestamo_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.prestamo
    ADD CONSTRAINT prestamo_pkey PRIMARY KEY (id_prestamo);


--
-- TOC entry 3440 (class 2606 OID 58333)
-- Name: reserva reserva_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.reserva
    ADD CONSTRAINT reserva_pkey PRIMARY KEY (id_reserva);


--
-- TOC entry 3389 (class 2606 OID 58186)
-- Name: socio socio_id_persona_key; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.socio
    ADD CONSTRAINT socio_id_persona_key UNIQUE (id_persona);


--
-- TOC entry 3391 (class 2606 OID 58184)
-- Name: socio socio_pkey; Type: CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.socio
    ADD CONSTRAINT socio_pkey PRIMARY KEY (id_socio);


--
-- TOC entry 3451 (class 1259 OID 58426)
-- Name: idx_auditoria_fecha; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_auditoria_fecha ON public.auditoria_general USING btree (fecha);


--
-- TOC entry 3452 (class 1259 OID 58425)
-- Name: idx_auditoria_tabla; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_auditoria_tabla ON public.auditoria_general USING btree (tabla_afectada);


--
-- TOC entry 3405 (class 1259 OID 58407)
-- Name: idx_autor_nombre; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_autor_nombre ON public.autor USING btree (nombre);


--
-- TOC entry 3402 (class 1259 OID 58406)
-- Name: idx_categoria_nombre; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_categoria_nombre ON public.categoria USING btree (nombre);


--
-- TOC entry 3421 (class 1259 OID 58414)
-- Name: idx_copia_estado; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_copia_estado ON public.copia USING btree (estado);


--
-- TOC entry 3422 (class 1259 OID 58413)
-- Name: idx_copia_idlibro; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_copia_idlibro ON public.copia USING btree (id_libro);


--
-- TOC entry 3435 (class 1259 OID 58417)
-- Name: idx_devolucion_idprestamo; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_devolucion_idprestamo ON public.devolucion USING btree (id_prestamo);


--
-- TOC entry 3399 (class 1259 OID 58405)
-- Name: idx_editorial_nombre; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_editorial_nombre ON public.editorial USING btree (nombre);


--
-- TOC entry 3447 (class 1259 OID 58424)
-- Name: idx_historial_idcopia; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_historial_idcopia ON public.historial_prestamo USING btree (id_copia);


--
-- TOC entry 3448 (class 1259 OID 58423)
-- Name: idx_historial_idsocio; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_historial_idsocio ON public.historial_prestamo USING btree (id_socio);


--
-- TOC entry 3411 (class 1259 OID 58412)
-- Name: idx_libro_autor_idautor; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_libro_autor_idautor ON public.libro_autor USING btree (id_autor);


--
-- TOC entry 3412 (class 1259 OID 58411)
-- Name: idx_libro_autor_idlibro; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_libro_autor_idlibro ON public.libro_autor USING btree (id_libro);


--
-- TOC entry 3406 (class 1259 OID 58410)
-- Name: idx_libro_categoria; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_libro_categoria ON public.libro USING btree (id_categoria);


--
-- TOC entry 3407 (class 1259 OID 58409)
-- Name: idx_libro_editorial; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_libro_editorial ON public.libro USING btree (id_editorial);


--
-- TOC entry 3408 (class 1259 OID 58408)
-- Name: idx_libro_titulo; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_libro_titulo ON public.libro USING btree (titulo);


--
-- TOC entry 3441 (class 1259 OID 58422)
-- Name: idx_multa_estado; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_multa_estado ON public.multa USING btree (estado);


--
-- TOC entry 3442 (class 1259 OID 58421)
-- Name: idx_multa_idsocio; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_multa_idsocio ON public.multa USING btree (id_socio);


--
-- TOC entry 3380 (class 1259 OID 58401)
-- Name: idx_persona_apellido; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_persona_apellido ON public.persona USING btree (apellido);


--
-- TOC entry 3381 (class 1259 OID 58402)
-- Name: idx_persona_correo; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_persona_correo ON public.persona USING btree (correo);


--
-- TOC entry 3382 (class 1259 OID 58400)
-- Name: idx_persona_nombre; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_persona_nombre ON public.persona USING btree (nombre);


--
-- TOC entry 3392 (class 1259 OID 58404)
-- Name: idx_personal_rol; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_personal_rol ON public.personal_biblioteca USING btree (rol);


--
-- TOC entry 3427 (class 1259 OID 58416)
-- Name: idx_prestamo_idcopia; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_prestamo_idcopia ON public.prestamo USING btree (id_copia);


--
-- TOC entry 3428 (class 1259 OID 58415)
-- Name: idx_prestamo_idsocio; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_prestamo_idsocio ON public.prestamo USING btree (id_socio);


--
-- TOC entry 3436 (class 1259 OID 58420)
-- Name: idx_reserva_estado; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_reserva_estado ON public.reserva USING btree (estado);


--
-- TOC entry 3437 (class 1259 OID 58419)
-- Name: idx_reserva_idcopia; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_reserva_idcopia ON public.reserva USING btree (id_copia);


--
-- TOC entry 3438 (class 1259 OID 58418)
-- Name: idx_reserva_idsocio; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_reserva_idsocio ON public.reserva USING btree (id_socio);


--
-- TOC entry 3387 (class 1259 OID 58403)
-- Name: idx_socio_tipo; Type: INDEX; Schema: public; Owner: grupo2
--

CREATE INDEX idx_socio_tipo ON public.socio USING btree (tipo_socio);


--
-- TOC entry 3473 (class 2620 OID 58499)
-- Name: autor trg_auditoria_autor; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_autor AFTER INSERT OR DELETE OR UPDATE ON public.autor FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3472 (class 2620 OID 58498)
-- Name: categoria trg_auditoria_categoria; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_categoria AFTER INSERT OR DELETE OR UPDATE ON public.categoria FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3475 (class 2620 OID 58495)
-- Name: copia trg_auditoria_copia; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_copia AFTER INSERT OR DELETE OR UPDATE ON public.copia FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3471 (class 2620 OID 58497)
-- Name: editorial trg_auditoria_editorial; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_editorial AFTER INSERT OR DELETE OR UPDATE ON public.editorial FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3479 (class 2620 OID 58496)
-- Name: historial_prestamo trg_auditoria_historial_prestamo; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_historial_prestamo AFTER INSERT OR DELETE OR UPDATE ON public.historial_prestamo FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3474 (class 2620 OID 58492)
-- Name: libro trg_auditoria_libro; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_libro AFTER INSERT OR DELETE OR UPDATE ON public.libro FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3478 (class 2620 OID 58494)
-- Name: multa trg_auditoria_multa; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_multa AFTER INSERT OR DELETE OR UPDATE ON public.multa FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3476 (class 2620 OID 58490)
-- Name: prestamo trg_auditoria_prestamo; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_prestamo AFTER INSERT OR DELETE OR UPDATE ON public.prestamo FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3477 (class 2620 OID 58493)
-- Name: reserva trg_auditoria_reserva; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_reserva AFTER INSERT OR DELETE OR UPDATE ON public.reserva FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3470 (class 2620 OID 58491)
-- Name: socio trg_auditoria_socio; Type: TRIGGER; Schema: public; Owner: grupo2
--

CREATE TRIGGER trg_auditoria_socio AFTER INSERT OR DELETE OR UPDATE ON public.socio FOR EACH ROW EXECUTE FUNCTION public.fn_auditoria_general();


--
-- TOC entry 3459 (class 2606 OID 58276)
-- Name: copia copia_id_libro_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.copia
    ADD CONSTRAINT copia_id_libro_fkey FOREIGN KEY (id_libro) REFERENCES public.libro(id_libro) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3463 (class 2606 OID 58322)
-- Name: devolucion devolucion_id_prestamo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.devolucion
    ADD CONSTRAINT devolucion_id_prestamo_fkey FOREIGN KEY (id_prestamo) REFERENCES public.prestamo(id_prestamo) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3468 (class 2606 OID 58373)
-- Name: historial_prestamo historial_prestamo_id_copia_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.historial_prestamo
    ADD CONSTRAINT historial_prestamo_id_copia_fkey FOREIGN KEY (id_copia) REFERENCES public.copia(id_copia) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3469 (class 2606 OID 58368)
-- Name: historial_prestamo historial_prestamo_id_socio_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.historial_prestamo
    ADD CONSTRAINT historial_prestamo_id_socio_fkey FOREIGN KEY (id_socio) REFERENCES public.socio(id_socio) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3460 (class 2606 OID 58291)
-- Name: inventario inventario_id_libro_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.inventario
    ADD CONSTRAINT inventario_id_libro_fkey FOREIGN KEY (id_libro) REFERENCES public.libro(id_libro) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3457 (class 2606 OID 58260)
-- Name: libro_autor libro_autor_id_autor_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro_autor
    ADD CONSTRAINT libro_autor_id_autor_fkey FOREIGN KEY (id_autor) REFERENCES public.autor(id_autor) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3458 (class 2606 OID 58255)
-- Name: libro_autor libro_autor_id_libro_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro_autor
    ADD CONSTRAINT libro_autor_id_libro_fkey FOREIGN KEY (id_libro) REFERENCES public.libro(id_libro) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3455 (class 2606 OID 58241)
-- Name: libro libro_id_categoria_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro
    ADD CONSTRAINT libro_id_categoria_fkey FOREIGN KEY (id_categoria) REFERENCES public.categoria(id_categoria) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3456 (class 2606 OID 58236)
-- Name: libro libro_id_editorial_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.libro
    ADD CONSTRAINT libro_id_editorial_fkey FOREIGN KEY (id_editorial) REFERENCES public.editorial(id_editorial) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3466 (class 2606 OID 58516)
-- Name: multa multa_id_prestamo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.multa
    ADD CONSTRAINT multa_id_prestamo_fkey FOREIGN KEY (id_prestamo) REFERENCES public.prestamo(id_prestamo) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3467 (class 2606 OID 58354)
-- Name: multa multa_id_socio_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.multa
    ADD CONSTRAINT multa_id_socio_fkey FOREIGN KEY (id_socio) REFERENCES public.socio(id_socio) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3454 (class 2606 OID 58201)
-- Name: personal_biblioteca personal_biblioteca_id_persona_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.personal_biblioteca
    ADD CONSTRAINT personal_biblioteca_id_persona_fkey FOREIGN KEY (id_persona) REFERENCES public.persona(id_persona) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3461 (class 2606 OID 58308)
-- Name: prestamo prestamo_id_copia_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.prestamo
    ADD CONSTRAINT prestamo_id_copia_fkey FOREIGN KEY (id_copia) REFERENCES public.copia(id_copia) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3462 (class 2606 OID 58303)
-- Name: prestamo prestamo_id_socio_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.prestamo
    ADD CONSTRAINT prestamo_id_socio_fkey FOREIGN KEY (id_socio) REFERENCES public.socio(id_socio) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3464 (class 2606 OID 58339)
-- Name: reserva reserva_id_copia_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.reserva
    ADD CONSTRAINT reserva_id_copia_fkey FOREIGN KEY (id_copia) REFERENCES public.copia(id_copia) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3465 (class 2606 OID 58334)
-- Name: reserva reserva_id_socio_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.reserva
    ADD CONSTRAINT reserva_id_socio_fkey FOREIGN KEY (id_socio) REFERENCES public.socio(id_socio) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3453 (class 2606 OID 58187)
-- Name: socio socio_id_persona_fkey; Type: FK CONSTRAINT; Schema: public; Owner: grupo2
--

ALTER TABLE ONLY public.socio
    ADD CONSTRAINT socio_id_persona_fkey FOREIGN KEY (id_persona) REFERENCES public.persona(id_persona) ON UPDATE CASCADE ON DELETE RESTRICT;


--
-- TOC entry 3667 (class 0 OID 0)
-- Dependencies: 248
-- Name: TABLE auditoria_general; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.auditoria_general TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.auditoria_general TO bibliotecario_rol;


--
-- TOC entry 3669 (class 0 OID 0)
-- Dependencies: 247
-- Name: SEQUENCE auditoria_general_id_auditoria_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.auditoria_general_id_auditoria_seq TO admin_rol;


--
-- TOC entry 3670 (class 0 OID 0)
-- Dependencies: 228
-- Name: TABLE autor; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.autor TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.autor TO bibliotecario_rol;


--
-- TOC entry 3672 (class 0 OID 0)
-- Dependencies: 227
-- Name: SEQUENCE autor_id_autor_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.autor_id_autor_seq TO admin_rol;


--
-- TOC entry 3673 (class 0 OID 0)
-- Dependencies: 226
-- Name: TABLE categoria; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.categoria TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.categoria TO bibliotecario_rol;
GRANT SELECT ON TABLE public.categoria TO socio_rol;


--
-- TOC entry 3675 (class 0 OID 0)
-- Dependencies: 225
-- Name: SEQUENCE categoria_id_categoria_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.categoria_id_categoria_seq TO admin_rol;


--
-- TOC entry 3676 (class 0 OID 0)
-- Dependencies: 234
-- Name: TABLE copia; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.copia TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.copia TO bibliotecario_rol;


--
-- TOC entry 3678 (class 0 OID 0)
-- Dependencies: 233
-- Name: SEQUENCE copia_id_copia_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.copia_id_copia_seq TO admin_rol;


--
-- TOC entry 3679 (class 0 OID 0)
-- Dependencies: 240
-- Name: TABLE devolucion; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.devolucion TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.devolucion TO bibliotecario_rol;


--
-- TOC entry 3681 (class 0 OID 0)
-- Dependencies: 239
-- Name: SEQUENCE devolucion_id_devolucion_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.devolucion_id_devolucion_seq TO admin_rol;


--
-- TOC entry 3682 (class 0 OID 0)
-- Dependencies: 224
-- Name: TABLE editorial; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.editorial TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.editorial TO bibliotecario_rol;


--
-- TOC entry 3684 (class 0 OID 0)
-- Dependencies: 223
-- Name: SEQUENCE editorial_id_editorial_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.editorial_id_editorial_seq TO admin_rol;


--
-- TOC entry 3685 (class 0 OID 0)
-- Dependencies: 246
-- Name: TABLE historial_prestamo; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.historial_prestamo TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.historial_prestamo TO bibliotecario_rol;


--
-- TOC entry 3687 (class 0 OID 0)
-- Dependencies: 245
-- Name: SEQUENCE historial_prestamo_id_historial_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.historial_prestamo_id_historial_seq TO admin_rol;


--
-- TOC entry 3688 (class 0 OID 0)
-- Dependencies: 236
-- Name: TABLE inventario; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.inventario TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.inventario TO bibliotecario_rol;
GRANT SELECT ON TABLE public.inventario TO socio_rol;


--
-- TOC entry 3690 (class 0 OID 0)
-- Dependencies: 235
-- Name: SEQUENCE inventario_id_inventario_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.inventario_id_inventario_seq TO admin_rol;


--
-- TOC entry 3691 (class 0 OID 0)
-- Dependencies: 230
-- Name: TABLE libro; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.libro TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.libro TO bibliotecario_rol;
GRANT SELECT ON TABLE public.libro TO socio_rol;


--
-- TOC entry 3692 (class 0 OID 0)
-- Dependencies: 232
-- Name: TABLE libro_autor; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.libro_autor TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.libro_autor TO bibliotecario_rol;


--
-- TOC entry 3694 (class 0 OID 0)
-- Dependencies: 231
-- Name: SEQUENCE libro_autor_id_libro_autor_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.libro_autor_id_libro_autor_seq TO admin_rol;


--
-- TOC entry 3696 (class 0 OID 0)
-- Dependencies: 229
-- Name: SEQUENCE libro_id_libro_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.libro_id_libro_seq TO admin_rol;


--
-- TOC entry 3697 (class 0 OID 0)
-- Dependencies: 244
-- Name: TABLE multa; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.multa TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.multa TO bibliotecario_rol;


--
-- TOC entry 3699 (class 0 OID 0)
-- Dependencies: 243
-- Name: SEQUENCE multa_id_multa_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.multa_id_multa_seq TO admin_rol;


--
-- TOC entry 3700 (class 0 OID 0)
-- Dependencies: 218
-- Name: TABLE persona; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.persona TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.persona TO bibliotecario_rol;


--
-- TOC entry 3702 (class 0 OID 0)
-- Dependencies: 217
-- Name: SEQUENCE persona_id_persona_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.persona_id_persona_seq TO admin_rol;


--
-- TOC entry 3703 (class 0 OID 0)
-- Dependencies: 222
-- Name: TABLE personal_biblioteca; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.personal_biblioteca TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.personal_biblioteca TO bibliotecario_rol;


--
-- TOC entry 3705 (class 0 OID 0)
-- Dependencies: 221
-- Name: SEQUENCE personal_biblioteca_id_personal_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.personal_biblioteca_id_personal_seq TO admin_rol;


--
-- TOC entry 3706 (class 0 OID 0)
-- Dependencies: 238
-- Name: TABLE prestamo; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.prestamo TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.prestamo TO bibliotecario_rol;


--
-- TOC entry 3708 (class 0 OID 0)
-- Dependencies: 237
-- Name: SEQUENCE prestamo_id_prestamo_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.prestamo_id_prestamo_seq TO admin_rol;


--
-- TOC entry 3709 (class 0 OID 0)
-- Dependencies: 242
-- Name: TABLE reserva; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.reserva TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.reserva TO bibliotecario_rol;


--
-- TOC entry 3711 (class 0 OID 0)
-- Dependencies: 241
-- Name: SEQUENCE reserva_id_reserva_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.reserva_id_reserva_seq TO admin_rol;


--
-- TOC entry 3712 (class 0 OID 0)
-- Dependencies: 220
-- Name: TABLE socio; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.socio TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.socio TO bibliotecario_rol;


--
-- TOC entry 3714 (class 0 OID 0)
-- Dependencies: 219
-- Name: SEQUENCE socio_id_socio_seq; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON SEQUENCE public.socio_id_socio_seq TO admin_rol;


--
-- TOC entry 3715 (class 0 OID 0)
-- Dependencies: 251
-- Name: TABLE vista_copias_disponibles_por_titulo; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.vista_copias_disponibles_por_titulo TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.vista_copias_disponibles_por_titulo TO bibliotecario_rol;


--
-- TOC entry 3716 (class 0 OID 0)
-- Dependencies: 253
-- Name: TABLE vista_historial_prestamos_por_socio; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.vista_historial_prestamos_por_socio TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.vista_historial_prestamos_por_socio TO bibliotecario_rol;


--
-- TOC entry 3717 (class 0 OID 0)
-- Dependencies: 249
-- Name: TABLE vista_libros_prestados; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.vista_libros_prestados TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.vista_libros_prestados TO bibliotecario_rol;


--
-- TOC entry 3718 (class 0 OID 0)
-- Dependencies: 252
-- Name: TABLE vista_reservas_activas; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.vista_reservas_activas TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.vista_reservas_activas TO bibliotecario_rol;


--
-- TOC entry 3719 (class 0 OID 0)
-- Dependencies: 250
-- Name: TABLE vista_socios_con_multas_pendientes; Type: ACL; Schema: public; Owner: grupo2
--

GRANT ALL ON TABLE public.vista_socios_con_multas_pendientes TO admin_rol;
GRANT SELECT,INSERT,DELETE,UPDATE ON TABLE public.vista_socios_con_multas_pendientes TO bibliotecario_rol;


-- Completed on 2025-05-01 17:23:10 UTC

--
-- PostgreSQL database dump complete
--

